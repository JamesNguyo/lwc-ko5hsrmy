<template>
  <lightning-card title="Friendly Loan Company" icon-name="custom:custom14">
    <div class="slds-m-around_medium">
      <table>
        <tr>
          <td>
            <div class="slds-grid slds-gutters_medium slds-p-around_xx-small">
              <div class="slds-col slds-size_1-of-3">
                <span><lightning-combobox name="loan" label ="Choose Product" placeholder="Choose Loan Product" value={name}
              onchange={onLoanProductSelected} options={loanProducts}>
            </lightning-combobox></lightning-input></span>
              </div>
              <div class="slds-col slds-size_1-of-3">
                <span><lightning-input label="Amount" type="number" formatter="currency" value={principalAmount} onchange={onPrincipalSelected}></lightning-input></lightning-input></span>
              </div>
              <div class="slds-col slds-size_1-of-3">
                <span></span>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="slds-grid slds-gutters_medium slds-p-around_xx-small">
              <div class="slds-col slds-size_3-of-3">
                <span><lightning-progress-bar value="100" size="large"></lightning-progress-bar></span>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="slds-grid slds-gutters_medium slds-p-around_xx-small">
              <div class="slds-col slds-size_1-of-4">
                <span></span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span><b>Preset</b></span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span><b>Negotiated</b></span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span><b>Computed</b></span>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="slds-grid slds-gutters_medium slds-p-around_xx-small">
              <div class="slds-col slds-size_1-of-4">
                <span>Interest</span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span>{interestRatePreset}</span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span><lightning-input label="Interest Negotiated" name="interestRate" value={interestRate} onchange={onPresetRateChanged}
                    variant="label-hidden"></lightning-input></span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span><lightning-formatted-number value={interestRateComputed} maximum-fraction-digits="2"></lightning-formatted-number></span>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="slds-grid slds-gutters_medium slds-p-around_xx-small">
              <div class="slds-col slds-size_1-of-4">
                <span>Processing Fee</span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span>{processingFeeRatePreset}</span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span><lightning-input label="Processing Fee Negotiated" name="processingFeeRate" value={processingFeeRate} onchange={onPresetRateChanged}
                    variant="label-hidden"></lightning-input></span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span><lightning-formatted-number value={processingFeeRateComputed} maximum-fraction-digits="2"></lightning-formatted-number></span>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="slds-grid slds-gutters_medium slds-p-around_xx-small">
              <div class="slds-col slds-size_1-of-4">
                <span>Administration Fee</span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span>{adminFeeRatePreset}</span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span><lightning-input label="Admin Fee Negotiated" name="adminFeeRate" value={adminFeeRate} onchange={onPresetRateChanged}
                    variant="label-hidden"></lightning-input></span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span><lightning-formatted-number value={adminFeeRateComputed} maximum-fraction-digits="2"></lightning-formatted-number></span>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="slds-grid slds-gutters_medium slds-p-around_xx-small">
              <div class="slds-col slds-size_1-of-4">
                <span>Risk Fee</span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span>{riskFeeRatePreset} </lightning-input></span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span><lightning-input label="Risk Fee" value={riskFeeRate} onchange={onPresetRateChanged} variant="label-hidden">
                  </lightning-input></span>
              </div>
              <div class="slds-col slds-size_1-of-4">
                <span><lightning-formatted-number value={riskFeeRateComputed} maximum-fraction-digits="2"></lightning-formatted-number></span>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <td>

          </td>
        </tr>
        <tr>
          <td>
            <div class="slds-grid slds-gutters_medium slds-p-around_xx-small">
              <div class="slds-col slds-size_3-of-3">
                <span><lightning-progress-bar value="100" size="large"></lightning-progress-bar></span>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="slds-grid slds-gutters_medium slds-p-around_xx-small">
              <div class="slds-col slds-size_1-of-3">
                <span><lightning-input name="dtStart" type="Date" label="Expected Disbursement Date" value="2021-05-03"
                      onchange={onLoanDateChanged}></lightning-input></span>
              </div>
              <div class="slds-col slds-size_1-of-3">
                <span><lightning-input name="dtEnd" type="Date" label="Expected Finish Date" value="2022-05-03"
              onchange={onLoanDateChanged}></lightning-input></span>
              </div>
              <div class="slds-col slds-size_1-of-3">
                <span><lightning-input label="Loan Duration (Months)" value={loanDuration}></lightning-input></lightning-input></span>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class="slds-grid slds-gutters_medium slds-p-around_xx-small">
              <div class="slds-col slds-size_3-of-3">
                <span><lightning-progress-bar value="100" size="large"></lightning-progress-bar></span>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <p>Monthly Payment: <lightning-formatted-number value={monthlyPayment} maximum-fraction-digits="2">
              </lightning-formatted-number> over <lightning-formatted-number value={loanDuration}>
              </lightning-formatted-number> Months = <lightning-formatted-number value={totalRepayable}
                maximum-fraction-digits="2">
              </lightning-formatted-number>
            </p>
            <p>Total Interest: <lightning-formatted-number value={sumInterest} maximum-fraction-digits="2">
              </lightning-formatted-number>
            </p>
            <p>Total Fees (Excl Interest): <lightning-formatted-number value={sumFees} maximum-fraction-digits="2">
              </lightning-formatted-number>
            </p>
            <p>Monthly Fee Amount: <lightning-formatted-number value={sumFeesMonthly} maximum-fraction-digits="2">
              </lightning-formatted-number>
            </p>
            <p>Planned No of Payments: {loanDuration}</p>
            <p>No of Payments: {recalculatedDuration} over {totalLoanDuration} months</p>
            <p>Total Early Payments: {earlyPayments}</p>
            <p>&nbsp;</p>
          </td>
        </tr>
      </table>

      <template if:true={loanMonthsSchedule}>
        <table key={key} style="border-style: solid;">
          <tr>
            <th style="text-align: center;">Year</th>
            <th style="text-align: center;">Jan</th>
            <th style="text-align: center;">Feb</th>
            <th style="text-align: center;">Mar</th>
            <th style="text-align: center;">Apr</th>
            <th style="text-align: center;">May</th>
            <th style="text-align: center;">Jun</th>
            <th style="text-align: center;">Jul</th>
            <th style="text-align: center;">Aug</th>
            <th style="text-align: center;">Sep</th>
            <th style="text-align: center;">Oct</th>
            <th style="text-align: center;">Nov</th>
            <th style="text-align: center;">Dec</th>
          </tr>
          <template for:each={loanMonthsSchedule} for:item="mthsRow">
            <tr key={mthsRow.key}>
              <td>{mthsRow.key}</td>
              <template for:each={mthsRow.mths} for:item="mth">
                <td key={mth.month} style="border-style: solid;">
                  <lightning-card>
                    <p>
                      {mth.key}
                      <lightning-input name={mth.key} label={mth.key} type="Checkbox" value={mth.selected}
                        checked={mth.selected} onchange={onMonthSelected} variant="label-hidden"></lightning-input>
                    </p>
                    <p>Days: <lightning-formatted-number value={mth.daysBetween}></lightning-formatted-number>
                    </p>
                    <p>
                      <b>Bal: <lightning-formatted-number value={mth.runningBalance} maximum-fraction-digits="2"></lightning-formatted-number></b>
                    </p>
                    <p>Pmt: <lightning-formatted-number value={mth.monthlyPayment} maximum-fraction-digits="2">
                      </lightning-formatted-number>
                    </p>
                    <p>Prn: <lightning-formatted-number value={mth.monthlyPrincipal} maximum-fraction-digits="2">
                      </lightning-formatted-number>
                    </p>
                    <p>Int: <lightning-formatted-number value={mth.monthlyInterest} maximum-fraction-digits="2">
                      </lightning-formatted-number>
                    </p>
                    <p>Fees: <lightning-formatted-number value={mth.monthlyFees} maximum-fraction-digits="2">
                      </lightning-formatted-number>
                    </p>
                    <p>&nbsp;</p>
                    <p>
                      <lightning-input name={mth.key} label="Planned Payment" value={mth.plannedPayment}
                        onchange={onPlannedAmountChanged}></lightning-input>
                    </p>
                    <p>&nbsp;</p>
                    <p>
                      <b>Total Incl Fees: <lightning-formatted-number value={mth.totalPaymentInclFees} maximum-fraction-digits="2"></lightning-formatted-number></b>
                    </p>

                  </lightning-card>
                </td>
              </template>
            </tr>
          </template>
        </table>
      </template>

    </div>
  </lightning-card>
</template>